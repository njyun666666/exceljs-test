{"version":3,"sources":["../../../../../lib/xlsx/xform/table/filter-column-xform.js"],"names":["BaseXform","require","ListXform","CustomFilterXform","FilterXform","FilterColumnXform","map","customFilters","tag","count","empty","childXform","filters","model","options","colId","index","toString","xmlStream","openNode","hiddenButton","filterButton","render","closeNode","leafNode","node","parser","parseOpen","attributes","name","Error","JSON","stringify","parseClose","undefined","module","exports"],"mappings":"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","sourcesContent":["const BaseXform = require('../base-xform');\r\nconst ListXform = require('../list-xform');\r\n\r\nconst CustomFilterXform = require('./custom-filter-xform');\r\nconst FilterXform = require('./filter-xform');\r\n\r\nclass FilterColumnXform extends BaseXform {\r\n  constructor() {\r\n    super();\r\n\r\n    this.map = {\r\n      customFilters: new ListXform({\r\n        tag: 'customFilters',\r\n        count: false,\r\n        empty: true,\r\n        childXform: new CustomFilterXform(),\r\n      }),\r\n      filters: new ListXform({\r\n        tag: 'filters',\r\n        count: false,\r\n        empty: true,\r\n        childXform: new FilterXform(),\r\n      }),\r\n    };\r\n  }\r\n\r\n  get tag() {\r\n    return 'filterColumn';\r\n  }\r\n\r\n  prepare(model, options) {\r\n    model.colId = options.index.toString();\r\n  }\r\n\r\n  render(xmlStream, model) {\r\n    if (model.customFilters) {\r\n      xmlStream.openNode(this.tag, {\r\n        colId: model.colId,\r\n        hiddenButton: model.filterButton ? '0' : '1',\r\n      });\r\n\r\n      this.map.customFilters.render(xmlStream, model.customFilters);\r\n\r\n      xmlStream.closeNode();\r\n      return true;\r\n    }\r\n    xmlStream.leafNode(this.tag, {\r\n      colId: model.colId,\r\n      hiddenButton: model.filterButton ? '0' : '1',\r\n    });\r\n    return true;\r\n  }\r\n\r\n  parseOpen(node) {\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n      return true;\r\n    }\r\n    const {attributes} = node;\r\n    switch (node.name) {\r\n      case this.tag:\r\n        this.model = {\r\n          filterButton: attributes.hiddenButton === '0',\r\n        };\r\n        return true;\r\n      default:\r\n        this.parser = this.map[node.name];\r\n        if (this.parser) {\r\n          this.parseOpen(node);\r\n          return true;\r\n        }\r\n        throw new Error(`Unexpected xml node in parseOpen: ${JSON.stringify(node)}`);\r\n    }\r\n  }\r\n\r\n  parseText() {}\r\n\r\n  parseClose(name) {\r\n    if (this.parser) {\r\n      if (!this.parser.parseClose(name)) {\r\n        this.parser = undefined;\r\n      }\r\n      return true;\r\n    }\r\n    switch (name) {\r\n      case this.tag:\r\n        this.model.customFilters = this.map.customFilters.model;\r\n        return false;\r\n      default:\r\n        // could be some unrecognised tags\r\n        return true;\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = FilterColumnXform;\r\n"],"file":"filter-column-xform.js"}