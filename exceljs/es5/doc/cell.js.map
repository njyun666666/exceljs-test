{"version":3,"sources":["../../../lib/doc/cell.js"],"names":["colCache","require","_","Enums","slideFormula","Note","Cell","row","column","address","Error","_row","_column","validateAddress","_address","_value","Value","create","Types","Null","style","_mergeStyle","_mergeCount","worksheet","workbook","numFmt","value","font","alignment","border","fill","protection","rowStyle","colStyle","number","letter","type","effectiveType","toCsvString","Merge","master","ignoreStyle","release","isMergedTo","Hyperlink","hyperlink","v","getType","_comment","note","toString","escapeHtml","text","String","formula","result","formulaType","sheetName","name","col","names","definedNames","getNamesEx","fullAddress","removeAllNames","forEach","addEx","removeEx","dataValidations","_dataValidations","find","add","model","comment","fromModel","ValueType","NullValue","cell","NumberValue","Number","StringValue","replace","RichTextValue","richText","map","t","join","RichText","DateValue","Date","toISOString","HyperlinkValue","undefined","tooltip","MergeValue","_master","addMergeRef","releaseMergeRef","FormulaValue","Formula","shareType","ref","sharedFormula","copy","cp","_copyModel","ranges","match","cells","_getTranslatedFormula","FormulaType","Master","Shared","None","_translatedFormula","findCell","SharedStringValue","SharedString","BooleanValue","Boolean","ErrorValue","error","JSONValue","JSON","stringify","rawValue","sharedString","types","f","reduce","p","T","module","exports"],"mappings":"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","sourcesContent":["/* eslint-disable max-classes-per-file */\r\nconst colCache = require('../utils/col-cache');\r\nconst _ = require('../utils/under-dash');\r\nconst Enums = require('./enums');\r\nconst {slideFormula} = require('../utils/shared-formula');\r\nconst Note = require('./note');\r\n// Cell requirements\r\n//  Operate inside a worksheet\r\n//  Store and retrieve a value with a range of types: text, number, date, hyperlink, reference, formula, etc.\r\n//  Manage/use and manipulate cell format either as local to cell or inherited from column or row.\r\n\r\nclass Cell {\r\n  constructor(row, column, address) {\r\n    if (!row || !column) {\r\n      throw new Error('A Cell needs a Row');\r\n    }\r\n\r\n    this._row = row;\r\n    this._column = column;\r\n\r\n    colCache.validateAddress(address);\r\n    this._address = address;\r\n\r\n    // TODO: lazy evaluation of this._value\r\n    this._value = Value.create(Cell.Types.Null, this);\r\n\r\n    this.style = this._mergeStyle(row.style, column.style, {});\r\n\r\n    this._mergeCount = 0;\r\n  }\r\n\r\n  get worksheet() {\r\n    return this._row.worksheet;\r\n  }\r\n\r\n  get workbook() {\r\n    return this._row.worksheet.workbook;\r\n  }\r\n\r\n  // help GC by removing cyclic (and other) references\r\n  destroy() {\r\n    delete this.style;\r\n    delete this._value;\r\n    delete this._row;\r\n    delete this._column;\r\n    delete this._address;\r\n  }\r\n\r\n  // =========================================================================\r\n  // Styles stuff\r\n  get numFmt() {\r\n    return this.style.numFmt;\r\n  }\r\n\r\n  set numFmt(value) {\r\n    this.style.numFmt = value;\r\n  }\r\n\r\n  get font() {\r\n    return this.style.font;\r\n  }\r\n\r\n  set font(value) {\r\n    this.style.font = value;\r\n  }\r\n\r\n  get alignment() {\r\n    return this.style.alignment;\r\n  }\r\n\r\n  set alignment(value) {\r\n    this.style.alignment = value;\r\n  }\r\n\r\n  get border() {\r\n    return this.style.border;\r\n  }\r\n\r\n  set border(value) {\r\n    this.style.border = value;\r\n  }\r\n\r\n  get fill() {\r\n    return this.style.fill;\r\n  }\r\n\r\n  set fill(value) {\r\n    this.style.fill = value;\r\n  }\r\n\r\n  get protection() {\r\n    return this.style.protection;\r\n  }\r\n\r\n  set protection(value) {\r\n    this.style.protection = value;\r\n  }\r\n\r\n  _mergeStyle(rowStyle, colStyle, style) {\r\n    const numFmt = (rowStyle && rowStyle.numFmt) || (colStyle && colStyle.numFmt);\r\n    if (numFmt) style.numFmt = numFmt;\r\n\r\n    const font = (rowStyle && rowStyle.font) || (colStyle && colStyle.font);\r\n    if (font) style.font = font;\r\n\r\n    const alignment = (rowStyle && rowStyle.alignment) || (colStyle && colStyle.alignment);\r\n    if (alignment) style.alignment = alignment;\r\n\r\n    const border = (rowStyle && rowStyle.border) || (colStyle && colStyle.border);\r\n    if (border) style.border = border;\r\n\r\n    const fill = (rowStyle && rowStyle.fill) || (colStyle && colStyle.fill);\r\n    if (fill) style.fill = fill;\r\n\r\n    const protection = (rowStyle && rowStyle.protection) || (colStyle && colStyle.protection);\r\n    if (protection) style.protection = protection;\r\n\r\n    return style;\r\n  }\r\n\r\n  // =========================================================================\r\n  // return the address for this cell\r\n  get address() {\r\n    return this._address;\r\n  }\r\n\r\n  get row() {\r\n    return this._row.number;\r\n  }\r\n\r\n  get col() {\r\n    return this._column.number;\r\n  }\r\n\r\n  get $col$row() {\r\n    return `$${this._column.letter}$${this.row}`;\r\n  }\r\n\r\n  // =========================================================================\r\n  // Value stuff\r\n\r\n  get type() {\r\n    return this._value.type;\r\n  }\r\n\r\n  get effectiveType() {\r\n    return this._value.effectiveType;\r\n  }\r\n\r\n  toCsvString() {\r\n    return this._value.toCsvString();\r\n  }\r\n\r\n  // =========================================================================\r\n  // Merge stuff\r\n\r\n  addMergeRef() {\r\n    this._mergeCount++;\r\n  }\r\n\r\n  releaseMergeRef() {\r\n    this._mergeCount--;\r\n  }\r\n\r\n  get isMerged() {\r\n    return this._mergeCount > 0 || this.type === Cell.Types.Merge;\r\n  }\r\n\r\n  merge(master, ignoreStyle) {\r\n    this._value.release();\r\n    this._value = Value.create(Cell.Types.Merge, this, master);\r\n    if (!ignoreStyle) {\r\n      this.style = master.style;\r\n    }\r\n  }\r\n\r\n  unmerge() {\r\n    if (this.type === Cell.Types.Merge) {\r\n      this._value.release();\r\n      this._value = Value.create(Cell.Types.Null, this);\r\n      this.style = this._mergeStyle(this._row.style, this._column.style, {});\r\n    }\r\n  }\r\n\r\n  isMergedTo(master) {\r\n    if (this._value.type !== Cell.Types.Merge) return false;\r\n    return this._value.isMergedTo(master);\r\n  }\r\n\r\n  get master() {\r\n    if (this.type === Cell.Types.Merge) {\r\n      return this._value.master;\r\n    }\r\n    return this; // an unmerged cell is its own master\r\n  }\r\n\r\n  get isHyperlink() {\r\n    return this._value.type === Cell.Types.Hyperlink;\r\n  }\r\n\r\n  get hyperlink() {\r\n    return this._value.hyperlink;\r\n  }\r\n\r\n  // return the value\r\n  get value() {\r\n    return this._value.value;\r\n  }\r\n\r\n  // set the value - can be number, string or raw\r\n  set value(v) {\r\n    // special case - merge cells set their master's value\r\n    if (this.type === Cell.Types.Merge) {\r\n      this._value.master.value = v;\r\n      return;\r\n    }\r\n\r\n    this._value.release();\r\n\r\n    // assign value\r\n    this._value = Value.create(Value.getType(v), this, v);\r\n  }\r\n\r\n  get note() {\r\n    return this._comment && this._comment.note;\r\n  }\r\n\r\n  set note(note) {\r\n    this._comment = new Note(note);\r\n  }\r\n\r\n  get text() {\r\n    return this._value.toString();\r\n  }\r\n\r\n  get html() {\r\n    return _.escapeHtml(this.text);\r\n  }\r\n\r\n  toString() {\r\n    return this.text;\r\n  }\r\n\r\n  _upgradeToHyperlink(hyperlink) {\r\n    // if this cell is a string, turn it into a Hyperlink\r\n    if (this.type === Cell.Types.String) {\r\n      this._value = Value.create(Cell.Types.Hyperlink, this, {\r\n        text: this._value.value,\r\n        hyperlink,\r\n      });\r\n    }\r\n  }\r\n\r\n  // =========================================================================\r\n  // Formula stuff\r\n  get formula() {\r\n    return this._value.formula;\r\n  }\r\n\r\n  get result() {\r\n    return this._value.result;\r\n  }\r\n\r\n  get formulaType() {\r\n    return this._value.formulaType;\r\n  }\r\n\r\n  // =========================================================================\r\n  // Name stuff\r\n  get fullAddress() {\r\n    const {worksheet} = this._row;\r\n    return {\r\n      sheetName: worksheet.name,\r\n      address: this.address,\r\n      row: this.row,\r\n      col: this.col,\r\n    };\r\n  }\r\n\r\n  get name() {\r\n    return this.names[0];\r\n  }\r\n\r\n  set name(value) {\r\n    this.names = [value];\r\n  }\r\n\r\n  get names() {\r\n    return this.workbook.definedNames.getNamesEx(this.fullAddress);\r\n  }\r\n\r\n  set names(value) {\r\n    const {definedNames} = this.workbook;\r\n    definedNames.removeAllNames(this.fullAddress);\r\n    value.forEach(name => {\r\n      definedNames.addEx(this.fullAddress, name);\r\n    });\r\n  }\r\n\r\n  addName(name) {\r\n    this.workbook.definedNames.addEx(this.fullAddress, name);\r\n  }\r\n\r\n  removeName(name) {\r\n    this.workbook.definedNames.removeEx(this.fullAddress, name);\r\n  }\r\n\r\n  removeAllNames() {\r\n    this.workbook.definedNames.removeAllNames(this.fullAddress);\r\n  }\r\n\r\n  // =========================================================================\r\n  // Data Validation stuff\r\n  get _dataValidations() {\r\n    return this.worksheet.dataValidations;\r\n  }\r\n\r\n  get dataValidation() {\r\n    return this._dataValidations.find(this.address);\r\n  }\r\n\r\n  set dataValidation(value) {\r\n    this._dataValidations.add(this.address, value);\r\n  }\r\n\r\n  // =========================================================================\r\n  // Model stuff\r\n\r\n  get model() {\r\n    const {model} = this._value;\r\n    model.style = this.style;\r\n    if (this._comment) {\r\n      model.comment = this._comment.model;\r\n    }\r\n    return model;\r\n  }\r\n\r\n  set model(value) {\r\n    this._value.release();\r\n    this._value = Value.create(value.type, this);\r\n    this._value.model = value;\r\n\r\n    if (value.comment) {\r\n      switch (value.comment.type) {\r\n        case 'note':\r\n          this._comment = Note.fromModel(value.comment);\r\n          break;\r\n      }\r\n    }\r\n\r\n    if (value.style) {\r\n      this.style = value.style;\r\n    } else {\r\n      this.style = {};\r\n    }\r\n  }\r\n}\r\nCell.Types = Enums.ValueType;\r\n\r\n// =============================================================================\r\n// Internal Value Types\r\n\r\nclass NullValue {\r\n  constructor(cell) {\r\n    this.model = {\r\n      address: cell.address,\r\n      type: Cell.Types.Null,\r\n    };\r\n  }\r\n\r\n  get value() {\r\n    return null;\r\n  }\r\n\r\n  set value(value) {\r\n    // nothing to do\r\n  }\r\n\r\n  get type() {\r\n    return Cell.Types.Null;\r\n  }\r\n\r\n  get effectiveType() {\r\n    return Cell.Types.Null;\r\n  }\r\n\r\n  get address() {\r\n    return this.model.address;\r\n  }\r\n\r\n  set address(value) {\r\n    this.model.address = value;\r\n  }\r\n\r\n  toCsvString() {\r\n    return '';\r\n  }\r\n\r\n  release() {}\r\n\r\n  toString() {\r\n    return '';\r\n  }\r\n}\r\n\r\nclass NumberValue {\r\n  constructor(cell, value) {\r\n    this.model = {\r\n      address: cell.address,\r\n      type: Cell.Types.Number,\r\n      value,\r\n    };\r\n  }\r\n\r\n  get value() {\r\n    return this.model.value;\r\n  }\r\n\r\n  set value(value) {\r\n    this.model.value = value;\r\n  }\r\n\r\n  get type() {\r\n    return Cell.Types.Number;\r\n  }\r\n\r\n  get effectiveType() {\r\n    return Cell.Types.Number;\r\n  }\r\n\r\n  get address() {\r\n    return this.model.address;\r\n  }\r\n\r\n  set address(value) {\r\n    this.model.address = value;\r\n  }\r\n\r\n  toCsvString() {\r\n    return this.model.value.toString();\r\n  }\r\n\r\n  release() {}\r\n\r\n  toString() {\r\n    return this.model.value.toString();\r\n  }\r\n}\r\n\r\nclass StringValue {\r\n  constructor(cell, value) {\r\n    this.model = {\r\n      address: cell.address,\r\n      type: Cell.Types.String,\r\n      value,\r\n    };\r\n  }\r\n\r\n  get value() {\r\n    return this.model.value;\r\n  }\r\n\r\n  set value(value) {\r\n    this.model.value = value;\r\n  }\r\n\r\n  get type() {\r\n    return Cell.Types.String;\r\n  }\r\n\r\n  get effectiveType() {\r\n    return Cell.Types.String;\r\n  }\r\n\r\n  get address() {\r\n    return this.model.address;\r\n  }\r\n\r\n  set address(value) {\r\n    this.model.address = value;\r\n  }\r\n\r\n  toCsvString() {\r\n    return `\"${this.model.value.replace(/\"/g, '\"\"')}\"`;\r\n  }\r\n\r\n  release() {}\r\n\r\n  toString() {\r\n    return this.model.value;\r\n  }\r\n}\r\n\r\nclass RichTextValue {\r\n  constructor(cell, value) {\r\n    this.model = {\r\n      address: cell.address,\r\n      type: Cell.Types.String,\r\n      value,\r\n    };\r\n  }\r\n\r\n  get value() {\r\n    return this.model.value;\r\n  }\r\n\r\n  set value(value) {\r\n    this.model.value = value;\r\n  }\r\n\r\n  toString() {\r\n    return this.model.value.richText.map(t => t.text).join('');\r\n  }\r\n\r\n  get type() {\r\n    return Cell.Types.RichText;\r\n  }\r\n\r\n  get effectiveType() {\r\n    return Cell.Types.RichText;\r\n  }\r\n\r\n  get address() {\r\n    return this.model.address;\r\n  }\r\n\r\n  set address(value) {\r\n    this.model.address = value;\r\n  }\r\n\r\n  toCsvString() {\r\n    return `\"${this.text.replace(/\"/g, '\"\"')}\"`;\r\n  }\r\n\r\n  release() {}\r\n}\r\n\r\nclass DateValue {\r\n  constructor(cell, value) {\r\n    this.model = {\r\n      address: cell.address,\r\n      type: Cell.Types.Date,\r\n      value,\r\n    };\r\n  }\r\n\r\n  get value() {\r\n    return this.model.value;\r\n  }\r\n\r\n  set value(value) {\r\n    this.model.value = value;\r\n  }\r\n\r\n  get type() {\r\n    return Cell.Types.Date;\r\n  }\r\n\r\n  get effectiveType() {\r\n    return Cell.Types.Date;\r\n  }\r\n\r\n  get address() {\r\n    return this.model.address;\r\n  }\r\n\r\n  set address(value) {\r\n    this.model.address = value;\r\n  }\r\n\r\n  toCsvString() {\r\n    return this.model.value.toISOString();\r\n  }\r\n\r\n  release() {}\r\n\r\n  toString() {\r\n    return this.model.value.toString();\r\n  }\r\n}\r\n\r\nclass HyperlinkValue {\r\n  constructor(cell, value) {\r\n    this.model = {\r\n      address: cell.address,\r\n      type: Cell.Types.Hyperlink,\r\n      text: value ? value.text : undefined,\r\n      hyperlink: value ? value.hyperlink : undefined,\r\n    };\r\n    if (value && value.tooltip) {\r\n      this.model.tooltip = value.tooltip;\r\n    }\r\n  }\r\n\r\n  get value() {\r\n    const v = {\r\n      text: this.model.text,\r\n      hyperlink: this.model.hyperlink,\r\n    };\r\n    if (this.model.tooltip) {\r\n      v.tooltip = this.model.tooltip;\r\n    }\r\n    return v;\r\n  }\r\n\r\n  set value(value) {\r\n    this.model = {\r\n      text: value.text,\r\n      hyperlink: value.hyperlink,\r\n    };\r\n    if (value.tooltip) {\r\n      this.model.tooltip = value.tooltip;\r\n    }\r\n  }\r\n\r\n  get text() {\r\n    return this.model.text;\r\n  }\r\n\r\n  set text(value) {\r\n    this.model.text = value;\r\n  }\r\n\r\n  /*\r\n  get tooltip() {\r\n    return this.model.tooltip;\r\n  }\r\n\r\n  set tooltip(value) {\r\n    this.model.tooltip = value;\r\n  } */\r\n\r\n  get hyperlink() {\r\n    return this.model.hyperlink;\r\n  }\r\n\r\n  set hyperlink(value) {\r\n    this.model.hyperlink = value;\r\n  }\r\n\r\n  get type() {\r\n    return Cell.Types.Hyperlink;\r\n  }\r\n\r\n  get effectiveType() {\r\n    return Cell.Types.Hyperlink;\r\n  }\r\n\r\n  get address() {\r\n    return this.model.address;\r\n  }\r\n\r\n  set address(value) {\r\n    this.model.address = value;\r\n  }\r\n\r\n  toCsvString() {\r\n    return this.model.hyperlink;\r\n  }\r\n\r\n  release() {}\r\n\r\n  toString() {\r\n    return this.model.text;\r\n  }\r\n}\r\n\r\nclass MergeValue {\r\n  constructor(cell, master) {\r\n    this.model = {\r\n      address: cell.address,\r\n      type: Cell.Types.Merge,\r\n      master: master ? master.address : undefined,\r\n    };\r\n    this._master = master;\r\n    if (master) {\r\n      master.addMergeRef();\r\n    }\r\n  }\r\n\r\n  get value() {\r\n    return this._master.value;\r\n  }\r\n\r\n  set value(value) {\r\n    if (value instanceof Cell) {\r\n      if (this._master) {\r\n        this._master.releaseMergeRef();\r\n      }\r\n      value.addMergeRef();\r\n      this._master = value;\r\n    } else {\r\n      this._master.value = value;\r\n    }\r\n  }\r\n\r\n  isMergedTo(master) {\r\n    return master === this._master;\r\n  }\r\n\r\n  get master() {\r\n    return this._master;\r\n  }\r\n\r\n  get type() {\r\n    return Cell.Types.Merge;\r\n  }\r\n\r\n  get effectiveType() {\r\n    return this._master.effectiveType;\r\n  }\r\n\r\n  get address() {\r\n    return this.model.address;\r\n  }\r\n\r\n  set address(value) {\r\n    this.model.address = value;\r\n  }\r\n\r\n  toCsvString() {\r\n    return '';\r\n  }\r\n\r\n  release() {\r\n    this._master.releaseMergeRef();\r\n  }\r\n\r\n  toString() {\r\n    return this.value.toString();\r\n  }\r\n}\r\n\r\nclass FormulaValue {\r\n  constructor(cell, value) {\r\n    this.cell = cell;\r\n\r\n    this.model = {\r\n      address: cell.address,\r\n      type: Cell.Types.Formula,\r\n      shareType: value ? value.shareType : undefined,\r\n      ref: value ? value.ref : undefined,\r\n      formula: value ? value.formula : undefined,\r\n      sharedFormula: value ? value.sharedFormula : undefined,\r\n      result: value ? value.result : undefined,\r\n    };\r\n  }\r\n\r\n  _copyModel(model) {\r\n    const copy = {};\r\n    const cp = name => {\r\n      const value = model[name];\r\n      if (value) {\r\n        copy[name] = value;\r\n      }\r\n    };\r\n    cp('formula');\r\n    cp('result');\r\n    cp('ref');\r\n    cp('shareType');\r\n    cp('sharedFormula');\r\n    return copy;\r\n  }\r\n\r\n  get value() {\r\n    return this._copyModel(this.model);\r\n  }\r\n\r\n  set value(value) {\r\n    this.model = this._copyModel(value);\r\n  }\r\n\r\n  validate(value) {\r\n    switch (Value.getType(value)) {\r\n      case Cell.Types.Null:\r\n      case Cell.Types.String:\r\n      case Cell.Types.Number:\r\n      case Cell.Types.Date:\r\n        break;\r\n      case Cell.Types.Hyperlink:\r\n      case Cell.Types.Formula:\r\n      default:\r\n        throw new Error('Cannot process that type of result value');\r\n    }\r\n  }\r\n\r\n  get dependencies() {\r\n    // find all the ranges and cells mentioned in the formula\r\n    const ranges = this.formula.match(/([a-zA-Z0-9]+!)?[A-Z]{1,3}\\d{1,4}:[A-Z]{1,3}\\d{1,4}/g);\r\n    const cells = this.formula\r\n      .replace(/([a-zA-Z0-9]+!)?[A-Z]{1,3}\\d{1,4}:[A-Z]{1,3}\\d{1,4}/g, '')\r\n      .match(/([a-zA-Z0-9]+!)?[A-Z]{1,3}\\d{1,4}/g);\r\n    return {\r\n      ranges,\r\n      cells,\r\n    };\r\n  }\r\n\r\n  get formula() {\r\n    return this.model.formula || this._getTranslatedFormula();\r\n  }\r\n\r\n  set formula(value) {\r\n    this.model.formula = value;\r\n  }\r\n\r\n  get formulaType() {\r\n    if (this.model.formula) {\r\n      return Enums.FormulaType.Master;\r\n    }\r\n    if (this.model.sharedFormula) {\r\n      return Enums.FormulaType.Shared;\r\n    }\r\n    return Enums.FormulaType.None;\r\n  }\r\n\r\n  get result() {\r\n    return this.model.result;\r\n  }\r\n\r\n  set result(value) {\r\n    this.model.result = value;\r\n  }\r\n\r\n  get type() {\r\n    return Cell.Types.Formula;\r\n  }\r\n\r\n  get effectiveType() {\r\n    const v = this.model.result;\r\n    if (v === null || v === undefined) {\r\n      return Enums.ValueType.Null;\r\n    }\r\n    if (v instanceof String || typeof v === 'string') {\r\n      return Enums.ValueType.String;\r\n    }\r\n    if (typeof v === 'number') {\r\n      return Enums.ValueType.Number;\r\n    }\r\n    if (v instanceof Date) {\r\n      return Enums.ValueType.Date;\r\n    }\r\n    if (v.text && v.hyperlink) {\r\n      return Enums.ValueType.Hyperlink;\r\n    }\r\n    if (v.formula) {\r\n      return Enums.ValueType.Formula;\r\n    }\r\n\r\n    return Enums.ValueType.Null;\r\n  }\r\n\r\n  get address() {\r\n    return this.model.address;\r\n  }\r\n\r\n  set address(value) {\r\n    this.model.address = value;\r\n  }\r\n\r\n  _getTranslatedFormula() {\r\n    if (!this._translatedFormula && this.model.sharedFormula) {\r\n      const {worksheet} = this.cell;\r\n      const master = worksheet.findCell(this.model.sharedFormula);\r\n      this._translatedFormula =\r\n        master && slideFormula(master.formula, master.address, this.model.address);\r\n    }\r\n    return this._translatedFormula;\r\n  }\r\n\r\n  toCsvString() {\r\n    return `${this.model.result || ''}`;\r\n  }\r\n\r\n  release() {}\r\n\r\n  toString() {\r\n    return this.model.result ? this.model.result.toString() : '';\r\n  }\r\n}\r\n\r\nclass SharedStringValue {\r\n  constructor(cell, value) {\r\n    this.model = {\r\n      address: cell.address,\r\n      type: Cell.Types.SharedString,\r\n      value,\r\n    };\r\n  }\r\n\r\n  get value() {\r\n    return this.model.value;\r\n  }\r\n\r\n  set value(value) {\r\n    this.model.value = value;\r\n  }\r\n\r\n  get type() {\r\n    return Cell.Types.SharedString;\r\n  }\r\n\r\n  get effectiveType() {\r\n    return Cell.Types.SharedString;\r\n  }\r\n\r\n  get address() {\r\n    return this.model.address;\r\n  }\r\n\r\n  set address(value) {\r\n    this.model.address = value;\r\n  }\r\n\r\n  toCsvString() {\r\n    return this.model.value.toString();\r\n  }\r\n\r\n  release() {}\r\n\r\n  toString() {\r\n    return this.model.value.toString();\r\n  }\r\n}\r\n\r\nclass BooleanValue {\r\n  constructor(cell, value) {\r\n    this.model = {\r\n      address: cell.address,\r\n      type: Cell.Types.Boolean,\r\n      value,\r\n    };\r\n  }\r\n\r\n  get value() {\r\n    return this.model.value;\r\n  }\r\n\r\n  set value(value) {\r\n    this.model.value = value;\r\n  }\r\n\r\n  get type() {\r\n    return Cell.Types.Boolean;\r\n  }\r\n\r\n  get effectiveType() {\r\n    return Cell.Types.Boolean;\r\n  }\r\n\r\n  get address() {\r\n    return this.model.address;\r\n  }\r\n\r\n  set address(value) {\r\n    this.model.address = value;\r\n  }\r\n\r\n  toCsvString() {\r\n    return this.model.value ? 1 : 0;\r\n  }\r\n\r\n  release() {}\r\n\r\n  toString() {\r\n    return this.model.value.toString();\r\n  }\r\n}\r\n\r\nclass ErrorValue {\r\n  constructor(cell, value) {\r\n    this.model = {\r\n      address: cell.address,\r\n      type: Cell.Types.Error,\r\n      value,\r\n    };\r\n  }\r\n\r\n  get value() {\r\n    return this.model.value;\r\n  }\r\n\r\n  set value(value) {\r\n    this.model.value = value;\r\n  }\r\n\r\n  get type() {\r\n    return Cell.Types.Error;\r\n  }\r\n\r\n  get effectiveType() {\r\n    return Cell.Types.Error;\r\n  }\r\n\r\n  get address() {\r\n    return this.model.address;\r\n  }\r\n\r\n  set address(value) {\r\n    this.model.address = value;\r\n  }\r\n\r\n  toCsvString() {\r\n    return this.toString();\r\n  }\r\n\r\n  release() {}\r\n\r\n  toString() {\r\n    return this.model.value.error.toString();\r\n  }\r\n}\r\n\r\nclass JSONValue {\r\n  constructor(cell, value) {\r\n    this.model = {\r\n      address: cell.address,\r\n      type: Cell.Types.String,\r\n      value: JSON.stringify(value),\r\n      rawValue: value,\r\n    };\r\n  }\r\n\r\n  get value() {\r\n    return this.model.rawValue;\r\n  }\r\n\r\n  set value(value) {\r\n    this.model.rawValue = value;\r\n    this.model.value = JSON.stringify(value);\r\n  }\r\n\r\n  get type() {\r\n    return Cell.Types.String;\r\n  }\r\n\r\n  get effectiveType() {\r\n    return Cell.Types.String;\r\n  }\r\n\r\n  get address() {\r\n    return this.model.address;\r\n  }\r\n\r\n  set address(value) {\r\n    this.model.address = value;\r\n  }\r\n\r\n  toCsvString() {\r\n    return this.model.value;\r\n  }\r\n\r\n  release() {}\r\n\r\n  toString() {\r\n    return this.model.value;\r\n  }\r\n}\r\n\r\n// Value is a place to hold common static Value type functions\r\nconst Value = {\r\n  getType(value) {\r\n    if (value === null || value === undefined) {\r\n      return Cell.Types.Null;\r\n    }\r\n    if (value instanceof String || typeof value === 'string') {\r\n      return Cell.Types.String;\r\n    }\r\n    if (typeof value === 'number') {\r\n      return Cell.Types.Number;\r\n    }\r\n    if (typeof value === 'boolean') {\r\n      return Cell.Types.Boolean;\r\n    }\r\n    if (value instanceof Date) {\r\n      return Cell.Types.Date;\r\n    }\r\n    if (value.text && value.hyperlink) {\r\n      return Cell.Types.Hyperlink;\r\n    }\r\n    if (value.formula || value.sharedFormula) {\r\n      return Cell.Types.Formula;\r\n    }\r\n    if (value.richText) {\r\n      return Cell.Types.RichText;\r\n    }\r\n    if (value.sharedString) {\r\n      return Cell.Types.SharedString;\r\n    }\r\n    if (value.error) {\r\n      return Cell.Types.Error;\r\n    }\r\n    return Cell.Types.JSON;\r\n  },\r\n\r\n  // map valueType to constructor\r\n  types: [\r\n    {t: Cell.Types.Null, f: NullValue},\r\n    {t: Cell.Types.Number, f: NumberValue},\r\n    {t: Cell.Types.String, f: StringValue},\r\n    {t: Cell.Types.Date, f: DateValue},\r\n    {t: Cell.Types.Hyperlink, f: HyperlinkValue},\r\n    {t: Cell.Types.Formula, f: FormulaValue},\r\n    {t: Cell.Types.Merge, f: MergeValue},\r\n    {t: Cell.Types.JSON, f: JSONValue},\r\n    {t: Cell.Types.SharedString, f: SharedStringValue},\r\n    {t: Cell.Types.RichText, f: RichTextValue},\r\n    {t: Cell.Types.Boolean, f: BooleanValue},\r\n    {t: Cell.Types.Error, f: ErrorValue},\r\n  ].reduce((p, t) => {\r\n    p[t.t] = t.f;\r\n    return p;\r\n  }, []),\r\n\r\n  create(type, cell, value) {\r\n    const T = this.types[type];\r\n    if (!T) {\r\n      throw new Error(`Could not create Value of type ${type}`);\r\n    }\r\n    return new T(cell, value);\r\n  },\r\n};\r\n\r\nmodule.exports = Cell;\r\n"],"file":"cell.js"}