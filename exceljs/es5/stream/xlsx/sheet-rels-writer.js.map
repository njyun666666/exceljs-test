{"version":3,"sources":["../../../../lib/stream/xlsx/sheet-rels-writer.js"],"names":["utils","require","RelType","HyperlinksProxy","sheetRelsWriter","writer","hyperlink","addHyperlink","SheetRelsWriter","options","id","count","_hyperlinks","_workbook","workbook","_stream","_openStream","length","fn","forEach","_hyperlinksProxy","relationship","Target","target","Type","Hyperlink","TargetMode","rId","_writeRelationship","push","address","media","rel","_writeClose","stream","end","write","_writeOpen","xmlEncode","module","exports"],"mappings":"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","sourcesContent":["/* eslint-disable max-classes-per-file */\r\nconst utils = require('../../utils/utils');\r\nconst RelType = require('../../xlsx/rel-type');\r\n\r\nclass HyperlinksProxy {\r\n  constructor(sheetRelsWriter) {\r\n    this.writer = sheetRelsWriter;\r\n  }\r\n\r\n  push(hyperlink) {\r\n    this.writer.addHyperlink(hyperlink);\r\n  }\r\n}\r\n\r\nclass SheetRelsWriter {\r\n  constructor(options) {\r\n    // in a workbook, each sheet will have a number\r\n    this.id = options.id;\r\n\r\n    // count of all relationships\r\n    this.count = 0;\r\n\r\n    // keep record of all hyperlinks\r\n    this._hyperlinks = [];\r\n\r\n    this._workbook = options.workbook;\r\n  }\r\n\r\n  get stream() {\r\n    if (!this._stream) {\r\n      // eslint-disable-next-line no-underscore-dangle\r\n      this._stream = this._workbook._openStream(`/xl/worksheets/_rels/sheet${this.id}.xml.rels`);\r\n    }\r\n    return this._stream;\r\n  }\r\n\r\n  get length() {\r\n    return this._hyperlinks.length;\r\n  }\r\n\r\n  each(fn) {\r\n    return this._hyperlinks.forEach(fn);\r\n  }\r\n\r\n  get hyperlinksProxy() {\r\n    return this._hyperlinksProxy || (this._hyperlinksProxy = new HyperlinksProxy(this));\r\n  }\r\n\r\n  addHyperlink(hyperlink) {\r\n    // Write to stream\r\n    const relationship = {\r\n      Target: hyperlink.target,\r\n      Type: RelType.Hyperlink,\r\n      TargetMode: 'External',\r\n    };\r\n    const rId = this._writeRelationship(relationship);\r\n\r\n    // store sheet stuff for later\r\n    this._hyperlinks.push({\r\n      rId,\r\n      address: hyperlink.address,\r\n    });\r\n  }\r\n\r\n  addMedia(media) {\r\n    return this._writeRelationship(media);\r\n  }\r\n\r\n  addRelationship(rel) {\r\n    return this._writeRelationship(rel);\r\n  }\r\n\r\n  commit() {\r\n    if (this.count) {\r\n      // write xml utro\r\n      this._writeClose();\r\n      // and close stream\r\n      this.stream.end();\r\n    }\r\n  }\r\n\r\n  // ================================================================================\r\n  _writeOpen() {\r\n    this.stream.write(\r\n      `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\r\n       <Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">`\r\n    );\r\n  }\r\n\r\n  _writeRelationship(relationship) {\r\n    if (!this.count) {\r\n      this._writeOpen();\r\n    }\r\n\r\n    const rId = `rId${++this.count}`;\r\n\r\n    if (relationship.TargetMode) {\r\n      this.stream.write(\r\n        `<Relationship Id=\"${rId}\"` +\r\n          ` Type=\"${relationship.Type}\"` +\r\n          ` Target=\"${utils.xmlEncode(relationship.Target)}\"` +\r\n          ` TargetMode=\"${relationship.TargetMode}\"` +\r\n          '/>'\r\n      );\r\n    } else {\r\n      this.stream.write(\r\n        `<Relationship Id=\"${rId}\" Type=\"${relationship.Type}\" Target=\"${relationship.Target}\"/>`\r\n      );\r\n    }\r\n\r\n    return rId;\r\n  }\r\n\r\n  _writeClose() {\r\n    this.stream.write('</Relationships>');\r\n  }\r\n}\r\n\r\nmodule.exports = SheetRelsWriter;\r\n"],"file":"sheet-rels-writer.js"}